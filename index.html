<html>

<head>
    <title>aframe game of life</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script>

        AFRAME.registerComponent('game-of-life', {

            init: function () {

                let start = undefined;  // TODO - get from attributes
                let aliveChance = 0.2;

                const cols = { low: -4, high: 4 };
                const rows = { low: -4, high: 4 };

                let x = cols.high - cols.low;
                let y = rows.high - rows.low;

                let grid = start ? start : Array.from(Array(x), () => [...Array(y)].map(() => Math.random() < aliveChance ? 1 : 0));

                var el = this.el;

                let z = 0;

                for (let c = cols.low, ix = 0; c < cols.high; c++, ix++) {
                    for (let r = rows.low, iy = 0; r < rows.high; r++, iy++) {
                        if (grid[ix][iy]) {
                            const obj = document.createElement("a-entity");
                            obj.setAttribute('mixin', 'tile');
                            obj.setAttribute("position", `${c} ${r} ${z}`);
                            obj.setAttribute('material', 'color', '#39ff14')
                            el.appendChild(obj);
                        }

                    }
                }
            }
        });

    </script>
</head>

<body>
    <a-scene>
        <a-assets>
            <a-mixin id="tile" geometry="primitive: box; width: 0.5; height: 0.5; depth: 0.5"></a-mixin>
            <a-mixin id="ball" geometry="primitive: sphere; radius: 0.2;"></a-mixin>
            <a-mixin id="fader"
                animation__fade="property: material.opacity; from:1; to:0; dur:2000; loop:false; easing:linear;"></a-mixin>
            <a-mixin id="shrinker"
                animation__shrinker="property: scale; from:1 1 1; to:0 0 0; dur:5000; loop:false; easing:linear;"></a-mixin>
        </a-assets>
        <a-entity id="rig" position="0 1.6 3">
            <a-entity id="camera" camera look-controls>
                <!-- <a-cursor></a-cursor> -->
            </a-entity>
        </a-entity>
        <a-entity id="game" position="0 1.6 -10" game-of-life></a-entity>
        <a-entity id="game" position="10 1.6 -10" game-of-life></a-entity>
        <a-entity id="game" position="-10 1.6 -10" game-of-life></a-entity>
        <a-sky color="#333333"></a-sky>
    </a-scene>

</body>

</html>